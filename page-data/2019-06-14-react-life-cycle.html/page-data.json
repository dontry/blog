{"componentChunkName":"component---src-templates-blog-post-js","path":"/2019-06-14-react-life-cycle.html","result":{"data":{"markdownRemark":{"html":"<p>React component provides several \"lifecycle methods\" that you can hook in at particular times. This <a href=\"http://projects.wojtekmaj.pl/react-lifecycle-methods-diagram\">lifecycle diagram</a> is very useful that you can use it as a cheat sheet for reference. Recently, I ran into a very complex component that I found it hard to wrap my head around . The most difficult part of that component is asynchronously fetching data in <em>componentDidUpdate</em> method in certain conditions. At the same time, <em>shouldComponentUpdate</em> method should be used properly to avoid redundant rendering. Therefore, I created a demo to simplify the props and state and retain the core logic. This demo has a button. When the button is clicked, the demo generates a random number consecutively ranging from 0 to 5 until the difference between current number and previous number is not greater than 1 or it throws an error.</p>\n<iframe src=\"https://codesandbox.io/embed/silly-shannon-1m5ne?fontsize=14\" title=\"React complicate lifecycle\" allow=\"geolocation; microphone; camera; midi; vr; accelerometer; gyroscope; payment; ambient-light-sensor; encrypted-media\" style=\"width:100%; height:500px; border:0; border-radius: 4px; overflow:hidden;\" sandbox=\"allow-modals allow-forms allow-popups allow-scripts allow-same-origin\"></iframe>\n<p>I made use of a few <em>console</em> APIs to illustrate what happens in every lifecycle method and when they are called. Specially <em>console.groupStart()</em> and <em>console.groupEnd()</em> help me to visualize what happened in each method and cycle.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 344px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/8663e764a657fd4b8ecd31146177ae44/75d93/react-lifecycle-log.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 189.30041152263377%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAmCAYAAADEO7urAAAACXBIWXMAAAsTAAALEwEAmpwYAAAD6ElEQVRIx51W13LiShT0/3/dfVjbJOUcRwHl0NszGNbs+oJsVZ0SAtQ6oU+3XpZlQdf1SNIMRVmi7TrIY13XH8VLR4A4TqAZJkRRKrB5niEf9JNQgHVdww9CGKaF87n5k+HyKb6T4TSOGIYeju8hTGL0w4BhHHB/rJviJRU1UnFG3c0I/RzG0UMcFciSCnXZo8galKJF2Yyb4iVRgA2qdoJIamRegXPVoyJQTaAirlGmBD1vBOz7TpXLBiDNUuimAddzMc0T5mVmEeu3yn5p2xZN0yAII+z2Rziupyb+vjvg9X1HcF9Nb56/MeWRQ5FHkqRw/QARaSTD9QI1/YosaPhgecPTKV8z9Ai0OxyxP5zwttvjqOk46QZ+vb3jnZlL0l/p9DTDgTSRWca3zHyVmQzLcWHZjvpOPlxS6mmGfd+rp8csORdCnW32sq7P6jd5rs9n9dBpmjYC8iJJZIYxM41VibKEe25v3BQJyM8oigKO4yCKog+wddMgvsxQCoLsXxhdpivLXpb1Z+Jw7WFZZPA8G1kWfyLr8hH3BH6YoQRlMvBDwHZmGNbE6YKcBAUDMGzweuVg+B9/YQKyDf+ToQSUYOhTzNkeSx1g7QpMwmGYmIWGMTcwnAWmruKkV9WKhxmO44QspnTZO4TuiapjIvVPSAMdnvmG0NmjbyspvU/VXAG2bUO1rigMLkzb48ZoOJxMHHUb7wcdr7sTHA6qH0aWOzzcFgUoN0XtcnoldsJV9FGSi5LQgnTKshxXRmzkoZSvDHku1M0pTesfYt/4vXH18pyKbRgIguBGja/KeljyVRxmXmS5LDejKEQsP/+48U9cr7eXnEZwXUudgemhMj8s+TqUslxJ3Ibkbgi6sAUr+7lwJRdmLF8IVgixYJye0qZV6nI4RhSGjt4MAl7AcgJI8DSTgMsFcHyyKT3LLquKK2cg4R7Py8jtGR/68sMeXkuuCr5BOCFFokJFe52GGUM7Yuyn7UO50kamW4YlMitDI306Iih9WrgCVVxhmZenfnJHGzWUqqDCuBxA8i0yf+l6QRgqH9bpydL5pEdfHO+gLFQemwVWZijfFKIo5Q6HCMOE2xLT9H3yMuC0hTIqaVDfWr0gcxHnpI4I4KU2YhFB8/dIi4jvNoL8G+/7uC6PPcWjoPoMI9khEBbcXMc++A9Fk6JsL6v4N5PUbn/yntumyD/HlatAnFxDUNiwsyOsdE+w7BJNjvwco+nJgFagG1sF+uUuS2ArMLC3X2EGGsxQg+4fsLN+QfeOLLlAUrEVuUnQBIIhQf/u6U2x5duXSWfyvBCabsGyXDUQTbOg87osqy+E8d/J/wa5ToZ52Iy1cAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"console\"\n        title=\"console\"\n        src=\"/static/8663e764a657fd4b8ecd31146177ae44/75d93/react-lifecycle-log.png\"\n        srcset=\"/static/8663e764a657fd4b8ecd31146177ae44/8aea6/react-lifecycle-log.png 243w,\n/static/8663e764a657fd4b8ecd31146177ae44/75d93/react-lifecycle-log.png 344w\"\n        sizes=\"(max-width: 344px) 100vw, 344px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Let's go through how <em>this.setState</em> works asynchronously. When the <em>loading</em> is set to true in <em>componentDidUpdate</em> method, it immediately goes to <em>shouldComponentUpdate</em>. If the condition is true, then it jumps to the <em>render</em> method.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 307px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/eeda447dd396ab1beee35b864fe4b38b/4651d/react-lifecycle-updatenumber.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 130.0411522633745%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAaCAYAAAC3g3x9AAAACXBIWXMAAAsTAAALEwEAmpwYAAADt0lEQVRIx51ViW7bVhD0/39Av6BF4TZJ49RpWqNuEzltkASWUZ8SJVGkeN+XeInHdPcpcpVKrosQWJDvgRzuzuzsO6iqCnmeI8uW8IMQlmXDME1Ytg3H9eB6PoIwRNd16Pv+0ThgwCzL4NLHI2mCqTyHrKiQpjNc3dzh8voWY2mKsizRti2aphEf8g/2hQDk4CtOEuiGCdtxKTMPnu/T2hJ7umkhTTMURSne7R7KsK5r8Xde2LEOJzERLX0s/AncxIAVLTC1bxDlPoo6oyxaAuPy1xR0fbdbMgNyui6B6cGcwKYUM3iJBdkZQfEklHWBMHOx79qm4B6QLzc1YURzEXo4g0Yxc2+hBhJl6CEtIpFpQMBZmSCvMrHXUtb/ZEglF0UBLt0MNIy0S0yNOyjOBKo7w1i/pr0rTM07FFVBFKhQiQ4jVBAuXZi0XrUrShObkmssl0tBvCzTy4oBSZIhTeZQVR2KouPmRsJsporW2l8yPudwozL3Ifee7TjQDAOGZYnQqS+5nTTdEJ2QpKkQZcPbjihcMi88PxCA3MhzZUHN7WC1WqGmKMtKPDdN+2APfiYKA8ZxLBqcAaMoBvPL+/9W9FGnbAATKsegUheLhchaNPD/tNwOIDPLHLJ3uXSNRGJnbEC7rhfRb933A245JYpDGgwGiWIhLzaK9p9ij7obCraqWGfIKjOgl8HWKbu5B9/JkacN8qRBFjVIggbLeIUqX9EeCZUTv6saHQ+LLW4PalKt9KjzT1/COHkD7acB9J8HUH48g3z0GvKL3zA/PsXo6SmU49cI35zB/OUtgt//RH3xHsWvr7Cajteg5JiDmp6aBTX04VeYXJ1g9PE51L9O4I/eYTo8hnzxCpPzF5DOj+DcvkU0GiKfXaNTZTRETzk4RflusKaAxttBRb2V0piSj49w9+wJxs+f4fLwW1x9f4jRD09FDL/5GtdPvkP0xwDt5RDV8APK8/eoLj4S2Bka4pwz7AQgO4WEaWjDI2vZcQLNC6A6HswwhkHKK7ZL/rbIxzHytkNGNO2I80kY4eV129D4osHqkO2CgADVBQyyWkLNniYpAqoiiiIUdFzUlASXdx87Km+cQo0dUEZ8d1z3wWHwX47ZsZ6madB1jQZGudXU+wfBo4BBGInhwEOBY0nlrUG/wHprwBA2H5/EI/PVto2g/Iu8vB4OGUxS06QTLs9LMTibpiPg/j442839wVNvfTT2NLpABz3Iz8BM7jGfdzRUe6haj9G4E/ck7ekdsmnU783+b9ylxukXGFckAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"update_number\"\n        title=\"update_number\"\n        src=\"/static/eeda447dd396ab1beee35b864fe4b38b/4651d/react-lifecycle-updatenumber.png\"\n        srcset=\"/static/eeda447dd396ab1beee35b864fe4b38b/8aea6/react-lifecycle-updatenumber.png 243w,\n/static/eeda447dd396ab1beee35b864fe4b38b/4651d/react-lifecycle-updatenumber.png 307w\"\n        sizes=\"(max-width: 307px) 100vw, 307px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>You can notice that <strong>the Promise callback of updating number runs outside <em>didComponentUpdate</em> method</strong>. This state update then triggers another round of component rendering. Due to the nature of asynchronous update, you should always get a previous component state from the <em>this.setState</em> callback arguments instead of using <em>this.state</em>.\nOtherwise, you may not get the consistent state for update.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">setState</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">prevState</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  number<span class=\"token operator\">:</span> number<span class=\"token punctuation\">,</span>\n  status<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token operator\">...</span>prevState<span class=\"token punctuation\">.</span>status<span class=\"token punctuation\">,</span> number<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  loading<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>The last thing should be noted is the <a href=\"https://reactjs.org/docs/react-component.html#componentdidcatch\"><em>componentDidCatch</em></a> method and the <a href=\"https://reactjs.org/docs/error-boundaries.html\"><em>ErrorBoundary</em></a> component. I found the component didn't catch the error thrown by its child component which got me confused. I later found the <a href=\"https://github.com/facebook/react/issues/11334\">answer</a>. What it says is that error boundaries only catch errors in lifecycle methods. If the error occurs in a Promise callback, it technically doesn't happen inside the lifecycle methods. So the error boundary won't catch it. In this case, you are supposed to handle the error for the Promise callback within the scope.</p>","frontmatter":{"title":"React component lifecycle","tags":["REACT"],"excerpt":"React component lifecycle is a very important part of React. I created a demo to illustrate how it works with full details"},"fields":{"date":"June 13, 2019","path":"/2019-06-14-react-life-cycle.html","slug":"/blog/2019/06/14/react-life-cycle.html"}}},"pageContext":{"id":"0b4df791-e02b-5b52-becd-e56e532e5641","prev":{"id":"b3f8f1ce-836c-55ad-b23d-42ad5e2c4156","frontmatter":{"title":"TypesScript Decorator 01","excerpt":null,"tags":["TYPESCRIPT"]},"fields":{"path":"/2021-06-20-typescript-decorator-01.html"}},"next":{"id":"f45c2c06-4fee-54db-a32a-520347ac8cee","frontmatter":{"title":"Angular ControlContainer","excerpt":"ControlContainer solves the issue how the parent form accesses or controls and child form when they reside in different components. ","tags":["ANGULAR"]},"fields":{"path":"/2021-06-02-control-container.html"}}}},"staticQueryHashes":[]}