{"componentChunkName":"component---src-templates-blog-post-js","path":"/2019-06-12-nextjs-ie-support.html","result":{"data":{"markdownRemark":{"html":"<p>Browser compatibility is a pain in the arse for many front-end developers. Although most modern browsers have supported the new features or syntax which mitigates the issues, the notorious IE browser is likely to be haunting around for a couple of years. Thus it is essential for us to learn some tricks to address these issues.</p>\n<p>When I decided to use Next.js to build the website, I didn't think too much about the support of IE. So I was panic when I was assigned to tackle this challenge. Luckily, <a href=\"https://nextjs.org/docs#browser-support\">Next.js supports IE11 out of box</a> which is a true life saver (another shout out for Next.js). Nevertheless, I still need to implement polyfill to handle specific problems. Browser compatibility comes down to two major parts -- JavaScript and CSS. I am going to elaborate both of them in two sections.</p>\n<h2>JavaScript</h2>\n<p>JavaScript compatibility takes syntax and new built-ins into account. The most essential tool to address JavaScript compatibility is Babel. <a href=\"https://babeljs.io/docs/en/index.html\">Babel</a> converts the new JavaScript code e.g. ES6+ into a backwards compatible version for older browsers or environments.</p>\n<h3>@babel/preset-env</h3>\n<p>Babel compiler has a wide range of plugins. The Babel community offers a preset environment <strong><a href=\"https://github.com/babel/babel-preset-env\">@babel/preset-env</a></strong> to make our life easier. The default preset includes features in babel-preset-es2015, babel-preset-es2016 and babel-preset-es2017. If you have an array of preset environments, they will be loaded from right to left. It means you should put the most backwards preset at the right end.</p>\n<p>the most basic <strong>.babelrc</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"presets\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"@babel/preset-env\"</span><span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3>Browserlist</h3>\n<p>If you want to include the polyfills and code transform for target browsers, you should then configure the <a href=\"https://github.com/browserslist/browserslist\">browserlist</a>. Browserlist is a very smart tool. It offers a range of semantic queries to identify the target browsers such as \">5%\" ( larger than 5% global usage), \"last 2 major versions\", \"ie 6-8\" etc. You can either set the browserlist in the <strong>.babelrc</strong> or create an isolated <strong>.browserlistrc</strong> file which is shared by other config files in the project.</p>\n<p><strong>.babelrc</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"presets\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">[</span>\n      <span class=\"token string\">\"env\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"targets\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token property\">\"browsers\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\">0.25%\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"not ie 11\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"not op_mini all\"</span><span class=\"token punctuation\">]</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><strong>.browserlist</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\"># Browsers that we support\nlast 1 version\n&gt; 1%\nIE 10</code></pre></div>\n<p><strong>package.json</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"private\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"dependencies\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"autoprefixer\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^6.5.4\"</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"browserslist\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"last 1 version\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"> 1%\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"IE 10\"</span><span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2>@babel/polyfill</h2>\n<p>Babel only transpiles JS syntax by default except for new built-ins such as Iterator, Generator, Set etc. In my case, the new ES6 method Array.from is not supported by ES5. It throws an error in an IE11 browser. So we had to add the plug-in <strong>@babel/polyfill</strong>. What we need to do is to install the <strong>@babel/polyfill</strong> as well as <strong>core-js</strong> in the <em>dependencies</em> (not <em>devDependencies</em>). The <strong>.babelrc</strong> should be configured like this. There are two options for \"useBuiltIns\".</p>\n<ul>\n<li>If \"usage\" is specified, then you don't need to include in either <strong>webpack.config.js</strong> entry array nor source.</li>\n<li>If \"entry\" is specified in <strong>.babelrc</strong> then include <strong>@babel/polyfill</strong> at the top of the entry point to your application via <em>require</em> or <em>import</em>.</li>\n<li>If use \"false\", you need to add the entry array in your <strong>webpack.config.js</strong>. In my case, the \"usage\" option doesn't include all modules for some reason. So I chose \"entry\" and import <strong>@babel/polyfill</strong> in head of the entry file.</li>\n</ul>\n<p><strong>.babelrc</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"presets\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">[</span>\n      <span class=\"token string\">\"@babel/preset-env\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"useBuiltIns\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"entry\"</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>However, the major downside of <strong>@babel/polyfill</strong> is its huge size. It adds all available methods to the prototypes. It could be a massive waste. We can only include particular <strong>core-js</strong> module to address this issue. Another problem of <strong>@babel/polyfill</strong> is that it pollutes global scope and prototypes. If it's used in a library, it could lead to unexpected consequences to the library users.</p>\n<h2>@babel/runtime, @babel/transform-runtime</h2>\n<p>In lieu of <strong>@babel/polyfill</strong>, there is an alternative -- <strong>@babel/plugin-transform-runtime</strong>. It only generates the necessary helpers in the source which significantly reduces the size of imports. Plus, the imports don't pollute the global scope. <strong>@babel/plugin-transform-runtime</strong> is often used along with <strong>@babel/runtime</strong> which removes the duplicate helpers generated by the transform plugin.</p>\n<blockquote>\n<p>A caveat should be noted is that instance method such as \"foobar\".includes(\"foo\") will not work since that would require modification of existing built-ins. Under this circumstance, you should use <strong>babel/polyfill</strong> instead.</p>\n</blockquote>\n<h2>CSS</h2>\n<p>CSS used to be a big mess among different browsers. The notorious IE browsers are a nightmare to many developers. Besides, the inconsistent feature support made by different vendors causes a serious headache.\nThere are various approaches to tackle this problem. I would introduce the most commonly used ways in the following.</p>\n<h3>PostCSS &#x26; Autoprefixer</h3>\n<p>One of the most popular ways to mitigate the differences of CSS rules across browsers is <a href=\"https://github.com/postcss/postcss\">PostCSS</a>. More precisely, it's the <a href=\"https://github.com/postcss/autoprefixer\">Autoprefixer</a> plugin. Basically, the plugin parses CSS and add vendor prefixes to CSS rules. To set up PostCSS in Next.js, you need to install <strong>@zeit/next-css</strong>, <strong>postcss-loader</strong> and optionally <strong>postcss-preset-env</strong>. Then create a <strong>next.config.js</strong> and a <strong>postcss.config.js</strong>.</p>\n<p><strong>next.config.js</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> withPlugins <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'next-compose-plugins'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> withCss <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'@zeit/next-css'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nmodule<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token function\">withPlugins</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>\n  <span class=\"token punctuation\">[</span>\n    withCss<span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span>\n      postcssLoaderOptions<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        parser<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p><strong>postcss.config.js</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">module<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  plugins<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token string\">'postcss-preset-env'</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<blockquote>\n<p>You can add '<em>grid: true</em>' to enable the grid layout in IE. Personally, I don't recommend it. Because grid layout in IE behaves very different than other popular browsers. The config also picks up <strong>.browserlistrc</strong> setting. You can specify it as '<em>browser: \"> 5%\"</em>' in the config or create an isolated <strong>.browserlist</strong> file as mentioned above.</p>\n</blockquote>\n<h3>&#x3C;!--[if IE]></h3>\n<h3>Property overrides</h3>\n<h3>@supports</h3>\n<h3>Modernizr</h3>","frontmatter":{"title":"Browser support issues in Next.js","tags":null,"excerpt":null},"fields":{"date":"June 11, 2019","path":"/2019-06-12-nextjs-ie-support.html","slug":"/blog/2019/06/12/nextjs-ie-support.html"}}},"pageContext":{"title":"Browser support issues in Next.js","slug":"/blog/2019/06/12/nextjs-ie-support.html","prev":{"html":"<p>A common nested form usually looks like this. Here <em>profileForm</em> contains a nested form <em>address</em> FormGroup. If <em>profileForm</em> needs to get access the <em>address</em> FormGroup, we can simply do this: <code class=\"language-text\">profileForm.get(&#39;address&#39;)</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Component <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@angular/core'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> FormGroup<span class=\"token punctuation\">,</span> FormControl <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@angular/forms'</span><span class=\"token punctuation\">;</span>\n\n@<span class=\"token function\">Component</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  selector<span class=\"token operator\">:</span> <span class=\"token string\">'app-profile-editor'</span><span class=\"token punctuation\">,</span>\n  templateUrl<span class=\"token operator\">:</span> <span class=\"token string\">'./profile-editor.component.html'</span><span class=\"token punctuation\">,</span>\n  styleUrls<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'./profile-editor.component.css'</span><span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ProfileEditorComponent</span> <span class=\"token punctuation\">{</span>\n  profileForm <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FormGroup</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    firstName<span class=\"token operator\">:</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FormControl</span><span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    lastName<span class=\"token operator\">:</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FormControl</span><span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    address<span class=\"token operator\">:</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FormGroup</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      street<span class=\"token operator\">:</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FormControl</span><span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      city<span class=\"token operator\">:</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FormControl</span><span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      state<span class=\"token operator\">:</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FormControl</span><span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      zip<span class=\"token operator\">:</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FormControl</span><span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>form</span> <span class=\"token attr-name\">[formGroup]</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>profileForm<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">(ngSubmit)</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>onSubmit()<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>label</span><span class=\"token punctuation\">></span></span>\n    First Name:\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>text<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">formControlName</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>firstName<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">required</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>label</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>label</span><span class=\"token punctuation\">></span></span>\n    Last Name:\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>text<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">formControlName</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>lastName<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>label</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">formGroupName</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>address<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h3</span><span class=\"token punctuation\">></span></span>Address<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h3</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>label</span><span class=\"token punctuation\">></span></span>\n      Street:\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>text<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">formControlName</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>street<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>label</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>label</span><span class=\"token punctuation\">></span></span>\n      City:\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>text<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">formControlName</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>city<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>label</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>label</span><span class=\"token punctuation\">></span></span>\n      State:\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>text<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">formControlName</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>state<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>label</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>label</span><span class=\"token punctuation\">></span></span>\n      Zip Code:\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>text<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">formControlName</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>zip<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>label</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">formArrayName</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>aliases<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h3</span><span class=\"token punctuation\">></span></span>Aliases<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h3</span><span class=\"token punctuation\">></span></span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">(click)</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>addAlias()<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Add Alias<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span>\n\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">*ngFor</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>let alias of aliases.controls; let i=index<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n      <span class=\"token comment\">&lt;!-- The repeated alias template --></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>label</span><span class=\"token punctuation\">></span></span>\n        Alias:\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>text<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">[formControlName]</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>i<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>label</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>submit<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">[disabled]</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>!profileForm.valid<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Submit<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>form</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>However, if we want to create a reusable or sophisticated component for <em>address</em> formGroup. How can the parent form <em>profileForm</em> access or control it? That's how <code class=\"language-text\">ControlContainer</code> comes into play. </p>\n<p>The injected <code class=\"language-text\">ControlContainer</code> looks up the component tree and finds the parent form.\nIt allows us to access the parent form across components. From there we can use the <code class=\"language-text\">formControlName</code> for our <code class=\"language-text\">FormControls</code> as expected.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// Profile form (parent form)</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Component <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@angular/core'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> FormGroup<span class=\"token punctuation\">,</span> FormControl <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@angular/forms'</span><span class=\"token punctuation\">;</span>\n\n@<span class=\"token function\">Component</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  selector<span class=\"token operator\">:</span> <span class=\"token string\">'app-profile-editor'</span><span class=\"token punctuation\">,</span>\n  templateUrl<span class=\"token operator\">:</span> <span class=\"token string\">'./profile-editor.component.html'</span><span class=\"token punctuation\">,</span>\n  styleUrls<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'./profile-editor.component.css'</span><span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ProfileEditorComponent</span> <span class=\"token punctuation\">{</span>\n  profileForm <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FormGroup</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    firstName<span class=\"token operator\">:</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FormControl</span><span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    lastName<span class=\"token operator\">:</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FormControl</span><span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// Address Form (child form)</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Component<span class=\"token punctuation\">,</span> OnInit <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@angular/core'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> ControlContainer <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@angular/forms'</span><span class=\"token punctuation\">;</span>\n\n@<span class=\"token function\">Component</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  selector<span class=\"token operator\">:</span> <span class=\"token string\">'app-address'</span><span class=\"token punctuation\">,</span>\n  template<span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\n  &lt;form  *ngIf=\"ogFormGroup\" [formGroup]=\"addressForm\">\n    &lt;h5>Address:&lt;/h5>\n    &lt;div class=\"form-group\">\n      &lt;label for=\"name\">Street Name&lt;/label>\n      &lt;input formControlName=\"street\" />\n    &lt;/div>\n    &lt;div class=\"form-group\">\n      &lt;label for=\"name\">City&lt;/label>\n      &lt;input formControlName=\"city\" />\n    &lt;/div>\n    &lt;div class=\"form-group\">\n      &lt;label for=\"name\">State&lt;/label>\n      &lt;input formControlName=\"state\" />\n    &lt;/div>\n    &lt;div class=\"form-group\">\n      &lt;label for=\"name\">Zip&lt;/label>\n      &lt;input formControlName=\"zip\" />\n    &lt;/div>\n  &lt;/form>\n  </span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n  styleUrls<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'./address.component.less'</span><span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AddressComponent</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">OnInit</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">public</span> parentForm<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">public</span> addressForm<span class=\"token punctuation\">;</span>\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token keyword\">public</span> controlContainer<span class=\"token operator\">:</span> ControlContainer</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">ngOnInit</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>addressForm <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FormGroup</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      street<span class=\"token operator\">:</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FormControl</span><span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      city<span class=\"token operator\">:</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FormControl</span><span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      state<span class=\"token operator\">:</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FormControl</span><span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      zip<span class=\"token operator\">:</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FormControl</span><span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>parentForm <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>controlContainer<span class=\"token punctuation\">.</span>control<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>parentForm<span class=\"token punctuation\">.</span><span class=\"token function\">setControl</span><span class=\"token punctuation\">(</span><span class=\"token string\">'address'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>addressForm<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>addressForm<span class=\"token punctuation\">.</span><span class=\"token function\">setParent</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>parentForm<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>","id":"f45c2c06-4fee-54db-a32a-520347ac8cee","excerpt":"A common nested form usually looks like this. Here profileForm contains a nested form address FormGroup. If profileForm needs to get access the address FormGroup, we can simply do this: . However, if we want to create a reusable or sophisticated component for address formGroup…","frontmatter":{"title":"Angular ControlContainer","excerpt":"ControlContainer solves the issue how the parent form accesses or controls and child form when they reside in different components. ","tags":["Angular"]},"fields":{"slug":"/blog/2021/06/02/control-container.html","date":"June 01, 2021","path":"/2021-06-02-control-container.html"}},"next":{"html":"<p>React component provides several \"lifecycle methods\" that you can hook in at particular times. This <a href=\"http://projects.wojtekmaj.pl/react-lifecycle-methods-diagram\">lifecycle diagram</a> is very useful that you can use it as a cheat sheet for reference. Recently, I ran into a very complex component that I found it hard to wrap my head around . The most difficult part of that component is asynchronously fetching data in <em>componentDidUpdate</em> method in certain conditions. At the same time, <em>shouldComponentUpdate</em> method should be used properly to avoid redundant rendering. Therefore, I created a demo to simplify the props and state and retain the core logic. This demo has a button. When the button is clicked, the demo generates a random number consecutively ranging from 0 to 5 until the difference between current number and previous number is not greater than 1 or it throws an error.</p>\n<iframe src=\"https://codesandbox.io/embed/silly-shannon-1m5ne?fontsize=14\" title=\"React complicate lifecycle\" allow=\"geolocation; microphone; camera; midi; vr; accelerometer; gyroscope; payment; ambient-light-sensor; encrypted-media\" style=\"width:100%; height:500px; border:0; border-radius: 4px; overflow:hidden;\" sandbox=\"allow-modals allow-forms allow-popups allow-scripts allow-same-origin\"></iframe>\n<p>I made use of a few <em>console</em> APIs to illustrate what happens in every lifecycle method and when they are called. Specially <em>console.groupStart()</em> and <em>console.groupEnd()</em> help me to visualize what happened in each method and cycle.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 344px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/dontry.github.io/static/8663e764a657fd4b8ecd31146177ae44/75d93/react-lifecycle-log.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 189.30041152263377%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAmCAYAAADEO7urAAAACXBIWXMAAAsTAAALEwEAmpwYAAAD6ElEQVRIx51W13LiShT0/3/dfVjbJOUcRwHl0NszGNbs+oJsVZ0SAtQ6oU+3XpZlQdf1SNIMRVmi7TrIY13XH8VLR4A4TqAZJkRRKrB5niEf9JNQgHVdww9CGKaF87n5k+HyKb6T4TSOGIYeju8hTGL0w4BhHHB/rJviJRU1UnFG3c0I/RzG0UMcFciSCnXZo8galKJF2Yyb4iVRgA2qdoJIamRegXPVoyJQTaAirlGmBD1vBOz7TpXLBiDNUuimAddzMc0T5mVmEeu3yn5p2xZN0yAII+z2Rziupyb+vjvg9X1HcF9Nb56/MeWRQ5FHkqRw/QARaSTD9QI1/YosaPhgecPTKV8z9Ai0OxyxP5zwttvjqOk46QZ+vb3jnZlL0l/p9DTDgTSRWca3zHyVmQzLcWHZjvpOPlxS6mmGfd+rp8csORdCnW32sq7P6jd5rs9n9dBpmjYC8iJJZIYxM41VibKEe25v3BQJyM8oigKO4yCKog+wddMgvsxQCoLsXxhdpivLXpb1Z+Jw7WFZZPA8G1kWfyLr8hH3BH6YoQRlMvBDwHZmGNbE6YKcBAUDMGzweuVg+B9/YQKyDf+ToQSUYOhTzNkeSx1g7QpMwmGYmIWGMTcwnAWmruKkV9WKhxmO44QspnTZO4TuiapjIvVPSAMdnvmG0NmjbyspvU/VXAG2bUO1rigMLkzb48ZoOJxMHHUb7wcdr7sTHA6qH0aWOzzcFgUoN0XtcnoldsJV9FGSi5LQgnTKshxXRmzkoZSvDHku1M0pTesfYt/4vXH18pyKbRgIguBGja/KeljyVRxmXmS5LDejKEQsP/+48U9cr7eXnEZwXUudgemhMj8s+TqUslxJ3Ibkbgi6sAUr+7lwJRdmLF8IVgixYJye0qZV6nI4RhSGjt4MAl7AcgJI8DSTgMsFcHyyKT3LLquKK2cg4R7Py8jtGR/68sMeXkuuCr5BOCFFokJFe52GGUM7Yuyn7UO50kamW4YlMitDI306Iih9WrgCVVxhmZenfnJHGzWUqqDCuBxA8i0yf+l6QRgqH9bpydL5pEdfHO+gLFQemwVWZijfFKIo5Q6HCMOE2xLT9H3yMuC0hTIqaVDfWr0gcxHnpI4I4KU2YhFB8/dIi4jvNoL8G+/7uC6PPcWjoPoMI9khEBbcXMc++A9Fk6JsL6v4N5PUbn/yntumyD/HlatAnFxDUNiwsyOsdE+w7BJNjvwco+nJgFagG1sF+uUuS2ArMLC3X2EGGsxQg+4fsLN+QfeOLLlAUrEVuUnQBIIhQf/u6U2x5duXSWfyvBCabsGyXDUQTbOg87osqy+E8d/J/wa5ToZ52Iy1cAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"console\"\n        title=\"console\"\n        src=\"/dontry.github.io/static/8663e764a657fd4b8ecd31146177ae44/75d93/react-lifecycle-log.png\"\n        srcset=\"/dontry.github.io/static/8663e764a657fd4b8ecd31146177ae44/8aea6/react-lifecycle-log.png 243w,\n/dontry.github.io/static/8663e764a657fd4b8ecd31146177ae44/75d93/react-lifecycle-log.png 344w\"\n        sizes=\"(max-width: 344px) 100vw, 344px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Let's go through how <em>this.setState</em> works asynchronously. When the <em>loading</em> is set to true in <em>componentDidUpdate</em> method, it immediately goes to <em>shouldComponentUpdate</em>. If the condition is true, then it jumps to the <em>render</em> method.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 307px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/dontry.github.io/static/eeda447dd396ab1beee35b864fe4b38b/4651d/react-lifecycle-updatenumber.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 130.0411522633745%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAaCAYAAAC3g3x9AAAACXBIWXMAAAsTAAALEwEAmpwYAAADt0lEQVRIx51ViW7bVhD0/39Av6BF4TZJ49RpWqNuEzltkASWUZ8SJVGkeN+XeInHdPcpcpVKrosQWJDvgRzuzuzsO6iqCnmeI8uW8IMQlmXDME1Ytg3H9eB6PoIwRNd16Pv+0ThgwCzL4NLHI2mCqTyHrKiQpjNc3dzh8voWY2mKsizRti2aphEf8g/2hQDk4CtOEuiGCdtxKTMPnu/T2hJ7umkhTTMURSne7R7KsK5r8Xde2LEOJzERLX0s/AncxIAVLTC1bxDlPoo6oyxaAuPy1xR0fbdbMgNyui6B6cGcwKYUM3iJBdkZQfEklHWBMHOx79qm4B6QLzc1YURzEXo4g0Yxc2+hBhJl6CEtIpFpQMBZmSCvMrHXUtb/ZEglF0UBLt0MNIy0S0yNOyjOBKo7w1i/pr0rTM07FFVBFKhQiQ4jVBAuXZi0XrUrShObkmssl0tBvCzTy4oBSZIhTeZQVR2KouPmRsJsporW2l8yPudwozL3Ifee7TjQDAOGZYnQqS+5nTTdEJ2QpKkQZcPbjihcMi88PxCA3MhzZUHN7WC1WqGmKMtKPDdN+2APfiYKA8ZxLBqcAaMoBvPL+/9W9FGnbAATKsegUheLhchaNPD/tNwOIDPLHLJ3uXSNRGJnbEC7rhfRb933A245JYpDGgwGiWIhLzaK9p9ij7obCraqWGfIKjOgl8HWKbu5B9/JkacN8qRBFjVIggbLeIUqX9EeCZUTv6saHQ+LLW4PalKt9KjzT1/COHkD7acB9J8HUH48g3z0GvKL3zA/PsXo6SmU49cI35zB/OUtgt//RH3xHsWvr7Cajteg5JiDmp6aBTX04VeYXJ1g9PE51L9O4I/eYTo8hnzxCpPzF5DOj+DcvkU0GiKfXaNTZTRETzk4RflusKaAxttBRb2V0piSj49w9+wJxs+f4fLwW1x9f4jRD09FDL/5GtdPvkP0xwDt5RDV8APK8/eoLj4S2Bka4pwz7AQgO4WEaWjDI2vZcQLNC6A6HswwhkHKK7ZL/rbIxzHytkNGNO2I80kY4eV129D4osHqkO2CgADVBQyyWkLNniYpAqoiiiIUdFzUlASXdx87Km+cQo0dUEZ8d1z3wWHwX47ZsZ6madB1jQZGudXU+wfBo4BBGInhwEOBY0nlrUG/wHprwBA2H5/EI/PVto2g/Iu8vB4OGUxS06QTLs9LMTibpiPg/j442839wVNvfTT2NLpABz3Iz8BM7jGfdzRUe6haj9G4E/ck7ekdsmnU783+b9ylxukXGFckAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"update_number\"\n        title=\"update_number\"\n        src=\"/dontry.github.io/static/eeda447dd396ab1beee35b864fe4b38b/4651d/react-lifecycle-updatenumber.png\"\n        srcset=\"/dontry.github.io/static/eeda447dd396ab1beee35b864fe4b38b/8aea6/react-lifecycle-updatenumber.png 243w,\n/dontry.github.io/static/eeda447dd396ab1beee35b864fe4b38b/4651d/react-lifecycle-updatenumber.png 307w\"\n        sizes=\"(max-width: 307px) 100vw, 307px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>You can notice that <strong>the Promise callback of updating number runs outside <em>didComponentUpdate</em> method</strong>. This state update then triggers another round of component rendering. Due to the nature of asynchronous update, you should always get a previous component state from the <em>this.setState</em> callback arguments instead of using <em>this.state</em>.\nOtherwise, you may not get the consistent state for update.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">setState</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">prevState</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  number<span class=\"token operator\">:</span> number<span class=\"token punctuation\">,</span>\n  status<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token operator\">...</span>prevState<span class=\"token punctuation\">.</span>status<span class=\"token punctuation\">,</span> number<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  loading<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>The last thing should be noted is the <a href=\"https://reactjs.org/docs/react-component.html#componentdidcatch\"><em>componentDidCatch</em></a> method and the <a href=\"https://reactjs.org/docs/error-boundaries.html\"><em>ErrorBoundary</em></a> component. I found the component didn't catch the error thrown by its child component which got me confused. I later found the <a href=\"https://github.com/facebook/react/issues/11334\">answer</a>. What it says is that error boundaries only catch errors in lifecycle methods. If the error occurs in a Promise callback, it technically doesn't happen inside the lifecycle methods. So the error boundary won't catch it. In this case, you are supposed to handle the error for the Promise callback within the scope.</p>","id":"0b4df791-e02b-5b52-becd-e56e532e5641","excerpt":"React component provides several \"lifecycle methods\" that you can hook in at particular times. This lifecycle diagram is very useful that you can use it as a cheat sheet for reference. Recently, I ran into a very complex component that I found it hard to wrap my head around . The…","frontmatter":{"title":"React component lifecycle","excerpt":"React component lifecycle is a very important part of React. I created a demo to illustrate how it works with full details","tags":["React"]},"fields":{"slug":"/blog/2019/06/14/react-life-cycle.html","date":"June 13, 2019","path":"/2019-06-14-react-life-cycle.html"}}}},"staticQueryHashes":[]}